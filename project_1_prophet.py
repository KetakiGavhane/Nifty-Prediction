# -*- coding: utf-8 -*-
"""Project_1_Prophet.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1FwtulJ2XMTRaCnoOXkfToFpg7xvpnJDb
"""

import pandas as pd
from prophet import Prophet

df = pd.read_csv("/content/NIFTY 50_Data.csv")

df.head()

df.rename(columns = {'Date':'ds'}, inplace = True)

df['ds'] = pd.to_datetime(df['ds'])

df.info()

df.rename(columns = {'Close':'y'}, inplace = True)

df.info()

df=df.drop(['Open', 'High', 'Low'] , axis=1)

df.info()

df.head()

df=df.sort_values(by='ds')

df.set_index('ds', inplace=True)

df = df.resample('D').fillna(method='ffill')

df.reset_index(inplace=True)

df.head(10)

"""#Train test split"""

df_train=df.iloc[:len(df)-365]
df_test= df.iloc[len(df)-365:]

"""#Training the model"""

m= Prophet()
m.fit(df_train)

future= m.make_future_dataframe(periods=365)

forecast= m.predict(future)

forecast.tail()

forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()

df_test.tail()

"""Prophet in-built visualization"""

from prophet.plot import plot_plotly, plot_components_plotly

plot_plotly(m ,forecast)

plot_components_plotly(m, forecast)

"""#Evaluation"""

from sklearn.metrics import mean_squared_error,mean_absolute_error

predictions = forecast.iloc[-365:]['yhat']

print("Mean squared error=",mean_squared_error(predictions,df_test['y']))
print("Mean absolute error=",mean_absolute_error(predictions,df_test['y']))

from statsmodels.tools.eval_measures import rmse

print("Root mean squared error= ", rmse(predictions,df_test['y']))
print("Mean value of test dataset=", df_test['y'].mean())

"""# Changing parameters"""

n = Prophet(changepoint_range=0.95)

n.fit(df_train)
future= n.make_future_dataframe(periods=365)
forecast= n.predict(future)
forecast.tail()

forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()

df_test.tail()

plot_plotly(n ,forecast)

predictions1 = forecast.iloc[-365:]['yhat']

print("Mean squared error=",mean_squared_error(predictions1,df_test['y']))
print("Mean absolute error=",mean_absolute_error(predictions1,df_test['y']))
print("Root mean squared error= ", rmse(predictions1,df_test['y']))
print("Mean value of test dataset=", df_test['y'].mean())